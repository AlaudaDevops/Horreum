apiVersion: v1
kind: ConfigMap
metadata:
  name: horreum-config
  namespace: horreum
  labels:
    app: horreum
data:
  # ==================== 核心配置 ====================
  # 数据库认证模式 (不使用 Keycloak)
  HORREUM_ROLES_PROVIDER: "database"

  # 禁用 OIDC/Keycloak
  QUARKUS_OIDC_TENANT_ENABLED: "false"

  # ==================== Dev Services 禁用 ====================
  HORREUM_DEV_SERVICES_ENABLED: "false"
  QUARKUS_DATASOURCE_DEVSERVICES_ENABLED: "false"
  QUARKUS_DATASOURCE_MIGRATION_DEVSERVICES_ENABLED: "false"
  QUARKUS_KEYCLOAK_DEVSERVICES_ENABLED: "false"
  QUARKUS_ELASTICSEARCH_DEVSERVICES_ENABLED: "false"
  QUARKUS_AMQP_DEVSERVICES_ENABLED: "false"

  # 禁用 Elasticsearch 健康检查
  QUARKUS_ELASTICSEARCH_HEALTH_ENABLED: "false"

  # ==================== 数据库配置 ====================
  QUARKUS_DATASOURCE_DB_KIND: "postgresql"
  QUARKUS_DATASOURCE_JDBC_URL: "jdbc:postgresql://postgres-service:5432/horreum"
  QUARKUS_DATASOURCE_MIGRATION_JDBC_URL: "jdbc:postgresql://postgres-service:5432/horreum"
  QUARKUS_DATASOURCE_JDBC_MIN_SIZE: "3"
  QUARKUS_DATASOURCE_JDBC_MAX_SIZE: "25"
  QUARKUS_DATASOURCE_JDBC_INITIAL_SIZE: "3"

  # 内网不需要 SSL
  QUARKUS_DATASOURCE_JDBC_ADDITIONAL_JDBC_PROPERTIES_SSL: "false"

  # ==================== Liquibase 迁移 ====================
  QUARKUS_LIQUIBASE_MIGRATION_MIGRATE_AT_START: "true"
  QUARKUS_LIQUIBASE_MIGRATE_AT_START: "true"

  # ==================== AMQP 配置 ====================
  AMQP_HOST: "artemis-service"
  AMQP_PORT: "5672"
  AMQP_RECONNECT_ATTEMPTS: "100"
  AMQP_RECONNECT_INTERVAL: "10"

  # ==================== URL 配置 ====================
  # 根据实际部署地址修改
  HORREUM_URL: "http://horreum-service:8080"
  HORREUM_INTERNAL_URL: "http://horreum-service:8080"

  # ==================== HTTP 配置 ====================
  QUARKUS_HTTP_CORS: "true"
  QUARKUS_HTTP_CORS_ORIGINS: "*"
  QUARKUS_HTTP_AUTH_BASIC: "true"
  QUARKUS_HTTP_AUTH_PROACTIVE: "false"

  # ==================== 日志配置 ====================
  QUARKUS_LOG_LEVEL: "INFO"
  QUARKUS_LOG_CONSOLE_FORMAT: "%d{yyyy-MM-dd HH:mm:ss} %-5p [%c{2.}] (%t) %s%e%n"
